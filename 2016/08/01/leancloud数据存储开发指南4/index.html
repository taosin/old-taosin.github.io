<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="Nix的小黑屋">
  <meta name="keywords" content="">
  
    
<title>leadcloud数据存储开发指南(四)－Js篇 | Nix的小黑屋</title>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<!-- <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
<script src="/js/masonry.pkgd.min.js"></script>
</head>

<body>
	
	<header id="header">
	<div class="banner">
		<!-- <img src="http://images.iamtaoxin.com/1469696430979.jpg" alt=""> -->
	</div>
	<div class="header-container">
		<div class="logo-wrap">
		</div>
		<div class="nav">
			<nav class="main-nav">
				<ul class="main-nav-ul">
					
					<li class="main-nav-li">
						<a href="/" class="main-nav-link">首页</a>
					</li>
					
					<li class="main-nav-li">
						<a href="/blogs" class="main-nav-link">博客</a>
					</li>
					
					<li class="main-nav-li">
						<a href="/archives" class="main-nav-link">归档</a>
					</li>
					
					<li class="main-nav-li">
						<a href="/about" class="main-nav-link">关于</a>
					</li>
					
					<li class="main-nav-li">
						<a href="/archives" class="main-nav-link">实验室</a>
					</li>
					
					<li class="main-nav-li">
						<a href="/blogs" class="main-nav-link">阅读轨迹</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>
	<div className="container" id="container">
		<main class="blogs" id="blog">
	<div class="row justify-content-center">
		
			<div class="post col-xl-8 col-lg-10 col-md-10 col-sm-10">
  <div class="card">
    <img class="card-img-top" src="?imageView2/2/q/85" alt="Card image cap">
    <div class="card-body">
      <h5 class="card-title">leadcloud数据存储开发指南(四)－Js篇</h5>
      <p class="card-text">
        <h2 id="leadcloud数据存储开发指南-四-－Js篇"><a href="#leadcloud数据存储开发指南-四-－Js篇" class="headerlink" title="leadcloud数据存储开发指南(四)－Js篇"></a>leadcloud数据存储开发指南(四)－Js篇</h2><p>保存对象<br>AV.Object 对象在保存时可以设置选项来快捷完成关联操作，可用的选项属性有：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th style="text-align:center">类型</th>
<th style="text-align:right">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>fetchWhenSave</td>
<td style="text-align:center">BOOL</td>
<td style="text-align:right">对象成功保存后，自动返回该对象在云端的最新数据。用途请参考 更新计数器</td>
</tr>
<tr>
<td>query</td>
<td style="text-align:center">AV.Query</td>
<td style="text-align:right">当 query 中的条件满足后对象才能成功保存，否则放弃保存，并返回错误码 305。</td>
</tr>
</tbody>
</table>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new AV.Query(&apos;Wiki&apos;).first().then(function (data) &#123;</span><br><span class="line">    var wiki = data;</span><br><span class="line">    var currentVersion = wiki.get(&apos;version&apos;);</span><br><span class="line">    wiki.set(&apos;version&apos;, currentVersion + 1);</span><br><span class="line">    wiki.save(null, &#123;</span><br><span class="line">      query: new AV.Query(&apos;Wiki&apos;).equalTo(&apos;version&apos;, currentVersion)</span><br><span class="line">    &#125;).then(function (data) &#123;</span><br><span class="line">    &#125;, function (error) &#123;</span><br><span class="line">      if (error) &#123;</span><br><span class="line">        throw error;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, function (error) &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">      throw error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p>
<p>获取对象<br>每个被成功保存在云端的对象会有一个唯一的 Id 标识 id，因此获取对象的最基本的方法就是根据 id 来查询：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var query = new AV.Query(&apos;Todo&apos;);</span><br><span class="line">query.get(&apos;57328ca079bc44005c2472d0&apos;).then(function (data) &#123;</span><br><span class="line">  // 成功获得实例</span><br><span class="line">  // data 就是 id 为 57328ca079bc44005c2472d0 的 Todo 对象实例</span><br><span class="line">&#125;, function (error) &#123;</span><br><span class="line">  // 失败了</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果不想使用查询，还可以通过从本地构建一个 id，然后调用接口从云端把这个 id 的数据拉取到本地，示例代码如下:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 第一个参数是 className，第二个参数是 objectId</span><br><span class="line"> var todo = AV.Object.createWithoutData(&apos;Todo&apos;, &apos;5745557f71cfe40068c6abe0&apos;);</span><br><span class="line"> var title = todo.get(&apos;title&apos;);// 读取 title</span><br><span class="line"> var content = todo.get(&apos;content&apos;);// 读取 content</span><br></pre></td></tr></table></figure></p>
<p>获取 objectId<br>每一次对象存储成功之后，云端都会返回 id，它是一个全局唯一的属性。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var todo = new Todo();</span><br><span class="line"> todo.set(&apos;title&apos;, &apos;工程师周会&apos;);</span><br><span class="line"> todo.set(&apos;content&apos;, &apos;每周工程师会议，周一下午2点&apos;);</span><br><span class="line"> todo.save().then(function (todo) &#123;</span><br><span class="line">   // 成功保存之后，执行其他逻辑</span><br><span class="line">   // 获取 objectId</span><br><span class="line">   var objectId = todo.id;</span><br><span class="line"> &#125;, function (error) &#123;</span><br><span class="line">   // 失败之后执行其他逻辑</span><br><span class="line">   console.log(error);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>

      </p>
    </div>
    <div class="card-footer d-flex justify-content-between">
      
      <a href="/2017/05/20/vue-leancloud轻松打造个人博客/">
        上一篇：Vue+leancloud轻松打造个人博客
      </a>
      
      
      <a href="/2016/07/31/js实现对象的深度拷贝/" class="btn btn-link">
        下一篇：Js实现对象的深度拷贝
      </a>
      
    </div>
  </div>
</div>
		
	</div>
</main>

	</div>
	
</body>
</html>